---
import Layout from "../../layouts/Layout.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";
---
<Layout
  title={`Base64在线加密解密工具 | ${SITE_TITLE}`}
  description={`Base64在线加密解密工具 | ${SITE_DESCRIPTION}`}
>
  <div class="bg-gray-100 min-h-screen flex flex-col items-center justify-center pt-32 pb-32">
    <div class="bg-white p-8 shadow-md w-full max-w-lg card">
      <h1 class="text-2xl font-bold mb-4">Base64在线加密解密工具</h1>
      
      <!-- Base64加密 -->
      <div class="mb-4">
        <label for="encodeText" class="block text-sm font-medium">输入文本进行Base64加密</label>
        <textarea
          id="encodeText"
          class="input input-bordered w-full h-32"
          placeholder="请输入需要加密的文本..."
        ></textarea>
      </div>

      <div class="text-center mb-4">
        <button
          type="button"
          onclick="encodeBase64()"
          class="btn btn-info text-white w-full"
        >
          加密为Base64
        </button>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium">加密后的Base64</label>
        <textarea
          id="encodedBase64"
          class="input input-bordered w-full h-32"
          readonly
          placeholder="Base64加密后的结果..."
        ></textarea>
        <button
          type="button"
          onclick="copyResult('encodedBase64')"
          class="btn btn-sm btn-success mt-2"
        >
          复制
        </button>
      </div>

      <!-- Base64解密 -->
      <div class="mb-4">
        <label for="decodeText" class="block text-sm font-medium">输入Base64进行解密</label>
        <textarea
          id="decodeText"
          class="input input-bordered w-full h-32"
          placeholder="请输入Base64编码的文本..."
        ></textarea>
      </div>

      <div class="text-center mb-4">
        <button
          type="button"
          onclick="decodeBase64()"
          class="btn btn-info text-white w-full"
        >
          解密Base64
        </button>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium">解密后的文本</label>
        <textarea
          id="decodedText"
          class="input input-bordered w-full h-32"
          readonly
          placeholder="解密后的结果..."
        ></textarea>
        <button
          type="button"
          onclick="copyResult('decodedText')"
          class="btn btn-sm btn-success mt-2"
        >
          复制
        </button>
      </div>

      <!-- 文件上传 -->
      <div class="mb-4">
        <label for="fileInput" class="block text-sm font-medium">上传文件进行Base64转换</label>
        <input
          id="fileInput"
          type="file"
          class="input input-bordered w-full"
          onchange="handleFileUpload(event)"
        />
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium">文件Base64编码</label>
        <textarea
          id="fileBase64"
          class="input input-bordered w-full h-32"
          readonly
          placeholder="文件的Base64编码结果..."
        ></textarea>
      </div>

      <div class="flex justify-between space-x-4 mt-4">
        <button
          type="button"
          onclick="clearResult()"
          class="btn btn-error text-white w-full"
        >
          清除结果
        </button>
      </div>
    </div>
  </div>
</Layout>

<!-- 引入 base64 加解密相关工具 -->
<script is:inline>
  function encodeBase64() {
    const input = document.getElementById("encodeText").value;
    if (input.trim() === "") {
      alert("请输入有效的文本进行加密！");
      return;
    }

    const encoded = btoa(input);
    document.getElementById("encodedBase64").value = encoded;
  }

  function decodeBase64() {
    const input = document.getElementById("decodeText").value;
    if (input.trim() === "") {
      alert("请输入有效的Base64进行解密！");
      return;
    }

    try {
      const decoded = atob(input);
      document.getElementById("decodedText").value = decoded;
    } catch (e) {
      alert("Base64解密失败，请检查输入的Base64格式！");
    }
  }

  function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      const base64 = e.target.result.split(",")[1];
      document.getElementById("fileBase64").value = base64;
    };
    reader.readAsDataURL(file);
  }

  function copyResult(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    document.execCommand("copy");
    alert("结果已复制！");
  }

  function clearResult() {
    document.getElementById("encodeText").value = "";
    document.getElementById("encodedBase64").value = "";
    document.getElementById("decodeText").value = "";
    document.getElementById("decodedText").value = "";
    document.getElementById("fileInput").value = "";
    document.getElementById("fileBase64").value = "";
  }
</script>
